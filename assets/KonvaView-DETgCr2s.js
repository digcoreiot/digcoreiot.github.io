import{r as d,m as Ee,a as i,o as m,b as U,g as W,n as Re,j as n,w as a,d as R,f as Ge,F as I,i as P,e as u,t as w}from"./index-DjAcCz50.js";const Me={class:"konva-content"},Se=W("a",null,null,-1),X=2,De={__name:"KonvaView",setup(Te){const Y=d(window.innerWidth),q=d(window.innerHeight),k=d(0),G=d(0);d(1);const $=d([{text:"4.2寸",value:{w:400,h:300}},{text:"5.83寸",value:{w:600,h:480}},{text:"7.5寸",value:{w:800,h:480}}]),c=d($.value[0].value);function J(t){console.log(t),B()}const K=d(null),x=d(null),Q=d(null),M=d(null),Z=d(null),ee=d(null),L=d(null),te=d({width:c.value.w,height:c.value.h}),S=d(!1),ne=d(""),y=d([]),b=d(!1);d("");const ae=d(null),V=d(100),F=d("1"),O=d(null);Ee(()=>{B()});function B(){const t=document.getElementById("konvaContent");if(t){k.value=t.clientWidth,G.value=t.clientHeight;const e=k.value/c.value.w;console.log("画布容器宽度:",k.value,"墨水屏宽度:",c.value.w,"比例:",e),e<1&&(K.value={width:`${k.value}px`,height:`${G.value}px`,transform:`scale(${e})`})}else console.error('Element with id "konvaContent" not found.')}function oe(){y.value=[],x.value.getStage().clear()}function le(t){const e=t.getClientRect();return{vertical:[{guide:Math.round(e.x),offset:Math.round(t.x()-e.x),snap:"start"},{guide:Math.round(e.x+e.width/2),offset:Math.round(t.x()-e.x-e.width/2),snap:"center"},{guide:Math.round(e.x+e.width),offset:Math.round(t.x()-e.x-e.width),snap:"end"}],horizontal:[{guide:Math.round(e.y),offset:Math.round(t.y()-e.y),snap:"start"},{guide:Math.round(e.y+e.height/2),offset:Math.round(t.y()-e.y-e.height/2),snap:"center"},{guide:Math.round(e.y+e.height),offset:Math.round(t.y()-e.y-e.height),snap:"end"}]}}function ie(t){const e=x.value.getStage();var f=[0,e.width()/2,e.width()],r=[0,e.height()/2,e.height()];return e.find(".shape").forEach(_=>{if(_!==t){var s=_.getClientRect();f.push([s.x,s.x+s.width,s.x+s.width/2]),r.push([s.y,s.y+s.height,s.y+s.height/2])}}),{vertical:f.flat(),horizontal:r.flat()}}function de(t,e){var f=[],r=[];t.vertical.forEach(v=>{e.vertical.forEach(p=>{var g=Math.abs(v-p.guide);g<X&&f.push({lineGuide:v,diff:g,snap:p.snap,offset:p.offset})})}),t.horizontal.forEach(v=>{e.horizontal.forEach(p=>{var g=Math.abs(v-p.guide);g<X&&r.push({lineGuide:v,diff:g,snap:p.snap,offset:p.offset})})});var l=[],_=f.sort((v,p)=>v.diff-p.diff)[0],s=r.sort((v,p)=>v.diff-p.diff)[0];return _&&l.push({lineGuide:_.lineGuide,offset:_.offset,orientation:"V",snap:_.snap}),s&&l.push({lineGuide:s.lineGuide,offset:s.offset,orientation:"H",snap:s.snap}),l}function re(t){if(x.value.getStage().find(".guid-line").forEach(r=>{r.destroy()}),!t.length)return;const f=L.value.getNode();t.forEach(r=>{if(r.orientation==="H"){var l=new Konva.Line({points:[-6e3,r.lineGuide,6e3,r.lineGuide],stroke:"black",strokeWidth:4,name:"guid-line",dash:[4,6]});f.add(l),f.batchDraw()}else if(r.orientation==="V"){var l=new Konva.Line({points:[r.lineGuide,-6e3,r.lineGuide,6e3],stroke:"black",strokeWidth:4,name:"guid-line",dash:[4,6]});f.add(l),f.batchDraw()}})}function T(t){const e=le(t),f=ie(t),r=de(f,e);re(r),r.forEach(l=>{switch(l.snap){case"start":{switch(l.orientation){case"V":{t.attrs.x=l.lineGuide+l.offset;break}case"H":{t.attrs.y=l.lineGuide+l.offset;break}}break}case"center":{switch(l.orientation){case"V":{t.attrs.x=l.lineGuide+l.offset;break}case"H":{t.attrs.y=l.lineGuide+l.offset;break}}break}case"end":{switch(l.orientation){case"V":{t.attrs.x=l.lineGuide+l.offset;break}case"H":{t.attrs.y=l.lineGuide+l.offset;break}}break}}})}function A(t){x.value.getStage().find(".guid-line").forEach(f=>{f.destroy()})}function ue(){const t=new Konva.Rect({x:100,y:100,width:100,height:100,fill:"blue",draggable:!0,name:"shape"});t.on("dragmove",function(){T(t)}),t.on("dragend",function(){A()});const e=M.value.getNode();e.add(t),e.draw()}function se(){const t=new Konva.Star({x:10,y:10,numPoints:5,innerRadius:40,outerRadius:70,fill:"blue",draggable:!0,name:"shape"});t.on("dragmove",function(){T(t)}),t.on("dragend",function(){A()});const e=M.value.getNode();e.add(t),e.draw()}function ce(){const t=y.value.length;y.value.push({id:Math.round(Math.random()*1e4).toString(),name:"信息"+(t+1),x:t*10,y:t*10,text:"信息"+(t+1),fontSize:50,fill:"#000",background:"#333",padding:5})}function fe(t){console.log("点击的文本：",t),ne.value=t.target.text(),ae.value=t.target.id(),b.value=!0}function ve(t,e){b.value=!0}function pe(t,e){y.value.splice(e,1)}return(t,e)=>{const f=i("v-rect"),r=i("v-layer"),l=i("v-text"),_=i("v-line"),s=i("v-stage"),v=i("van-divider"),p=i("van-icon"),g=i("van-field"),z=i("van-cell-group"),C=i("van-tab"),D=i("van-button"),he=i("van-tabs"),h=i("van-radio"),H=i("van-radio-group"),_e=i("van-dropdown-item"),ge=i("van-dropdown-menu"),me=i("van-cell"),ye=i("van-action-bar-icon"),j=i("van-action-bar-button"),we=i("van-action-bar"),ke=i("van-slider"),xe=i("van-stepper"),be=i("van-popup"),Ve=i("van-dialog"),Ce=i("van-image");return m(),U(I,null,[W("div",Me,[W("div",{class:"konva-stage",id:"konvaContent",style:Re(K.value)},[n(s,{ref_key:"stageRef",ref:x,config:te.value},{default:a(()=>[n(r,{ref_key:"layerRefBg",ref:Q},{default:a(()=>[n(f,{config:{x:0,y:0,width:1e3,height:1e3,fill:"#fff",shadowColor:"black",shadowBlur:10,shadowOffsetX:10,shadowOffsetY:10,shadowOpacity:.2}})]),_:1},512),n(r,{ref_key:"layerRefShape",ref:M},null,512),n(r,{ref_key:"layerRefLogo",ref:Z},null,512),n(r,{ref_key:"layerRefText",ref:ee},{default:a(()=>[(m(!0),U(I,null,P(y.value,o=>(m(),R(l,{key:o.id,onTap:fe,onDragmove:E=>T(o),config:{id:o.id,draggable:!0,x:o.x,y:o.y,text:o.text,fontSize:o.fontSize,fontFamily:"Calibri",fill:o.fill,padding:o.padding}},null,8,["onDragmove","config"]))),128))]),_:1},512),n(r,{ref_key:"layerRefGuides",ref:L},{default:a(()=>[n(_,{config:{points:[0,0,c.value.w,c.value.h,0,c.value.h,c.value.w,0],stroke:"blue",strokeWidth:1}},null,8,["config"]),n(_,{config:{points:[0,0,0,c.value.h,c.value.w,c.value.h,c.value.w,0],stroke:"red",strokeWidth:5}},null,8,["config"])]),_:1},512)]),_:1},8,["config"])],4)]),n(v,{style:{color:"#1989fa",borderColor:"#1989fa",padding:"0 16px"}},{default:a(()=>[u(" 屏幕: "+w(Y.value)+" x "+w(q.value),1)]),_:1}),n(v,{style:{color:"#1989fa",borderColor:"#1989fa",padding:"0 16px"}},{default:a(()=>[u(" 容器: "+w(k.value)+" x "+w(G.value),1)]),_:1}),n(v,{style:{color:"#1989fa",borderColor:"#1989fa",padding:"0 16px"}},{default:a(()=>[u(" eink:"+w(c.value.w)+" x "+w(c.value.h),1)]),_:1}),n(he,{animated:""},{default:a(()=>[n(C,{title:"文字"},{default:a(()=>[n(z,null,{default:a(()=>[(m(!0),U(I,null,P(y.value,(o,E)=>(m(),R(g,{clearable:"",center:"",modelValue:o.text,"onUpdate:modelValue":N=>o.text=N,label:"信息"+(E+1),placeholder:"请输入内容"},{button:a(()=>[n(p,{style:{"margin-right":"20px"},name:"setting-o",color:"#0C5192",onClick:N=>ve(o,E)},null,8,["onClick"]),n(p,{name:"delete-o",color:"#ee0a24",onClick:N=>pe(o,E)},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","label"]))),256)),n(v,{onClick:e[0]||(e[0]=o=>ce()),dashed:"",style:{color:"#333",borderColor:"#333",padding:"20px 0px"}},{default:a(()=>[n(p,{name:"add"}),Se,u("添加文字 ")]),_:1})]),_:1})]),_:1}),n(C,{title:"图片"}),n(C,{title:"图形"},{default:a(()=>[n(z,null,{default:a(()=>[n(D,{type:"primary",icon:"plus-o",onClick:ue},{default:a(()=>[u("添加矩形")]),_:1}),n(D,{type:"primary",icon:"plus-o",onClick:se},{default:a(()=>[u("添加星形")]),_:1})]),_:1})]),_:1}),n(C,{title:"设置"},{default:a(()=>[n(D,{type:"danger",icon:"delete-o",onClick:e[1]||(e[1]=o=>S.value=!0)},{default:a(()=>[u("清空画布")]),_:1})]),_:1})]),_:1}),n(z,{title:"刷写屏幕"},{default:a(()=>[n(H,{modelValue:F.value,"onUpdate:modelValue":e[2]||(e[2]=o=>F.value=o),direction:"horizontal",style:{padding:"10px"}},{default:a(()=>[n(h,{name:"1"},{default:a(()=>[u("AB屏")]),_:1}),n(h,{name:"2"},{default:a(()=>[u("刷A屏")]),_:1}),n(h,{name:"3"},{default:a(()=>[u("刷B屏")]),_:1})]),_:1},8,["modelValue"])]),_:1}),(m(),R(me,{key:0,title:"选择eink"},{value:a(()=>[n(ge,null,{default:a(()=>[n(_e,{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=o=>c.value=o),options:$.value,onChange:J},null,8,["modelValue","options"])]),_:1})]),_:1})),n(v,null,{default:a(()=>[u(" 到底了~")]),_:1}),n(we,null,{default:a(()=>[n(ye,{icon:"underway-o",text:"历史设备",color:"#4D4D4D",style:{margin:"30px"}}),n(j,{type:"primary",icon:"scan",text:"扫码连接",color:"#333"}),n(j,{type:"primary",icon:"share-o",text:"写入设备"})]),_:1}),n(be,{show:b.value,"onUpdate:show":e[8]||(e[8]=o=>b.value=o),position:"bottom",style:{height:"30%"}},{default:a(()=>[n(g,{name:"radio",label:"字体选择"},{input:a(()=>[n(H,{modelValue:t.checked,"onUpdate:modelValue":e[4]||(e[4]=o=>t.checked=o),direction:"horizontal"},{default:a(()=>[n(h,{name:"0"},{default:a(()=>[u("默认")]),_:1}),n(h,{name:"1"},{default:a(()=>[u("宋体")]),_:1}),n(h,{name:"2"},{default:a(()=>[u("楷体")]),_:1}),n(h,{name:"3"},{default:a(()=>[u("魏碑体")]),_:1})]),_:1},8,["modelValue"])]),_:1}),n(g,{name:"radio",label:"文字颜色"},{input:a(()=>[n(H,{modelValue:t.checked,"onUpdate:modelValue":e[5]||(e[5]=o=>t.checked=o),direction:"horizontal"},{default:a(()=>[n(h,{name:"0"},{default:a(()=>[u("默认")]),_:1}),n(h,{name:"1"},{default:a(()=>[u("宋体")]),_:1}),n(h,{name:"2"},{default:a(()=>[u("楷体")]),_:1}),n(h,{name:"3"},{default:a(()=>[u("魏碑体")]),_:1})]),_:1},8,["modelValue"])]),_:1}),n(g,{name:"slider",label:"字号大小"},{input:a(()=>[n(ke,{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=o=>V.value=o),min:16,max:400},null,8,["modelValue"]),n(xe,{modelValue:V.value,"onUpdate:modelValue":e[7]||(e[7]=o=>V.value=o),min:16,max:400},null,8,["modelValue"])]),_:1})]),_:1},8,["show"]),n(Ve,{show:S.value,"onUpdate:show":e[9]||(e[9]=o=>S.value=o),title:"清空画布","show-cancel-button":"",onConfirm:oe},null,8,["show"]),O.value?(m(),R(Ce,{key:1,src:O.value},null,8,["src"])):Ge("",!0)],64)}}};export{De as default};
