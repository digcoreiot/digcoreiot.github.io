import{r as g,E as F,l as k,m as B,G as L,H as N,I as P,J as D,K as C,c as A,a as T,o as p,b as f,g as l,t as w,k as u,j as W,w as E,f as _,e as m}from"./index-DjAcCz50.js";function G(e){return N()?(P(e),!0):!1}const M=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;function V(e,t){function o(...s){return new Promise((a,i)=>{Promise.resolve(e(()=>t.apply(this,s),{fn:t,thisArg:this,args:s})).then(a).catch(i)})}return o}const x=e=>e();function q(e=x){const t=g(!0);function o(){t.value=!1}function s(){t.value=!0}const a=(...i)=>{t.value&&e(...i)};return{isActive:F(t),pause:o,resume:s,eventFilter:a}}function I(e){return D()}function O(e,t,o={}){const{eventFilter:s=x,...a}=o;return k(e,V(s,t),a)}function R(e,t,o={}){const{eventFilter:s,...a}=o,{eventFilter:i,pause:r,resume:c,isActive:v}=q(s);return{stop:O(e,t,{...a,eventFilter:i}),pause:r,resume:c,isActive:v}}function U(e,t=!0,o){I()?B(e,o):t?e():L(e)}const j=M?window.navigator:void 0;function H(){const e=g(!1),t=D();return t&&B(()=>{e.value=!0},t),e}function J(e){const t=H();return A(()=>(t.value,!!e()))}function K(e){let{acceptAllDevices:t=!1}=e||{};const{filters:o=void 0,optionalServices:s=void 0,navigator:a=j}=e||{},i=J(()=>a&&"bluetooth"in a),r=C(void 0),c=C(null);k(r,()=>{h()});async function v(){if(i.value){c.value=null,o&&o.length>0&&(t=!1);try{r.value=await(a==null?void 0:a.bluetooth.requestDevice({acceptAllDevices:t,filters:o,optionalServices:s}))}catch(n){c.value=n}}}const d=g(),y=A(()=>{var n;return((n=d.value)==null?void 0:n.connected)||!1});async function h(){if(c.value=null,r.value&&r.value.gatt){r.value.addEventListener("gattserverdisconnected",()=>{});try{d.value=await r.value.gatt.connect()}catch(n){c.value=n}}}return U(()=>{var n;r.value&&((n=r.value.gatt)==null||n.connect())}),G(()=>{var n;r.value&&((n=r.value.gatt)==null||n.disconnect())}),{isSupported:i,isConnected:y,device:r,requestDevice:v,server:d,error:c}}const Y={class:"grid grid-cols-1 gap-x-4 gap-y-4"},$={key:0},z={key:1},Q={key:2,class:"bg-green-500 text-white p-3 rounded-md"},X=l("p",null,"Connected",-1),Z=[X],ee={key:3,class:"bg-orange-800 text-white p-3 rounded-md"},te=l("p",null,"Not Connected",-1),ne=[te],oe={key:4},re=l("div",null,"Errors:",-1),se={class:"block p-5 whitespace-pre"},ie={__name:"useBluetooth",setup(e){const{isSupported:t,isConnected:o,device:s,requestDevice:a,server:i,error:r}=K({acceptAllDevices:!0,optionalServices:["battery_service"]}),c=g(10),v=g(!1),d=async()=>{v.value=!0;const n=await(await i.getPrimaryService("battery_service")).getCharacteristic("battery_level");n.addEventListener("characteristicvaluechanged",S=>{c.value=S.target.value.getUint8(0)});const b=await n.readValue();c.value=await b.getUint8(0)},{stop:y}=R(o,h=>{!h||!i.value||v.value||(d(),y())});return(h,n)=>{const b=T("van-button");return p(),f("div",Y,[l("div",null,w(u(t)?"Bluetooth Web API Supported":"Your browser does not support the Bluetooth Web API"),1),u(t)?(p(),f("div",$,[W(b,{onClick:n[0]||(n[0]=S=>u(a)())},{default:E(()=>[m("Request Bluetooth Device")]),_:1})])):_("",!0),u(s)?(p(),f("div",z,[l("p",null,"Device Name: "+w(u(s).name),1)])):_("",!0),u(o)?(p(),f("div",Q,Z)):_("",!0),u(o)?_("",!0):(p(),f("div",ee,ne)),u(r)?(p(),f("div",oe,[re,l("pre",null,[m("      "),l("code",se,w(u(r)),1),m(`
    `)])])):_("",!0)])}}};export{ie as default};
